#include <iostream>
#include <string>
using namespace std;

class Automaton
{
private:
   static const int RULES_SIZE = 8;

   bool rules[RULES_SIZE];
   string thisGen;
   string extremeBit;
   int displayWidth;

public:
   static const int MAX_DISPLAY_WIDTH = 121;
   static const int DFLT_DISPLAY_WIDTH = 79;
   static const int MAX_RULE = 255;

   Automaton(int rule);
   string toStringCurrentGen();
   bool setRule(int newRule);
   void resetFirstGen();
   bool setDisplayWidth(int width);
   void propagateNewGeneration();
};

int main()
{
   int rule, k;

   do
   {
      cout << "Enter Rule (0 - 255): ";
      cin >> rule;
   } while (rule < 0 || rule > 255);

   Automaton aut(rule);

   aut.setDisplayWidth(79);

   cout << "   start"  << endl;

   for (k = 0; k < 100; k++)
   {
      cout << aut.toStringCurrentGen() << endl;
      aut.propagateNewGeneration();
   }

   cout << "   end"  << endl;

   return 0;
}

Automaton::Automaton(int rule)
{
   setRule(rule);
   resetFirstGen();
}

string Automaton::toStringCurrentGen()
{
   string returnString = "";
   int numExtremeBits, truncExtremeBits;

   if (thisGen.length() <= displayWidth)
   {
      numExtremeBits = ((displayWidth - thisGen.length())/2);
      returnString = thisGen;
      while (numExtremeBits > 0)
      {
         returnString = extremeBit + returnString + extremeBit;
         numExtremeBits -= 1;
      }
   }

   if (thisGen.length() > displayWidth)
   {
      truncExtremeBits = ((thisGen.length() - displayWidth)/2);
      returnString = thisGen.substr(truncExtremeBits, (thisGen.length() - (truncExtremeBits*2)));
   }

   return returnString;
}

bool Automaton::setRule(int newRule)
{
   int k, n = newRule, mask = 1;

   if (n < 0 || n > MAX_RULE)
      return false;

   for (k = 0; k < 8; k++)
   {
      if( (n & (mask)) != 0)
         rules[k] = true;
      else
         rules[k] = false;
      mask *= 2;
   }
   return true;
}

void Automaton::resetFirstGen()
{
   thisGen = "*";
   extremeBit = " ";
}

bool Automaton::setDisplayWidth(int width)
{
   if (width < 0 || width > DFLT_DISPLAY_WIDTH || width % 2 == 0)
      return false;
   displayWidth = width;
   return true;
}

void Automaton::propagateNewGeneration()
{
   string nextGen = "", consecExtremeBits;
   int k, result, extremeBitRule;

   thisGen = extremeBit + extremeBit + thisGen + extremeBit + extremeBit;

   for (k = 0; k < (thisGen.length() - 2); k++)
   {
      result = 0;

      if (thisGen[k] == '*')
         result += 1;

      result = result << 1;

      if (thisGen[k+1] == '*')
         result += 1;

      result = result << 1;

      if (thisGen[k+2] == '*')
         result += 1;

      if (rules[result])
         nextGen += '*';
      else
         nextGen += ' ';
   }

   thisGen = nextGen;

   consecExtremeBits = extremeBit + extremeBit + extremeBit;

   if (consecExtremeBits == "   ")
      extremeBitRule = 0;
   else
      extremeBitRule = 7;

   if(rules[extremeBitRule])
      extremeBit = '*';
   else
      extremeBit = ' ';
}

/* ---------------------- run #1 ------------------------------

Enter Rule (0 - 255): 4
   start
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
                                       *                                       
   end

----------------------------------------------------------------------*/

/* ------------------------- run #2 -----------------------------------
 
 Enter Rule (0 - 255): 126
   start
                                       *                                       
                                      ***                                      
                                     ** **                                     
                                    *******                                    
                                   **     **                                   
                                  ****   ****                                  
                                 **  ** **  **                                 
                                ***************                                
                               **             **                               
                              ****           ****                              
                             **  **         **  **                             
                            ********       ********                            
                           **      **     **      **                           
                          ****    ****   ****    ****                          
                         **  **  **  ** **  **  **  **                         
                        *******************************                        
                       **                             **                       
                      ****                           ****                      
                     **  **                         **  **                     
                    ********                       ********                    
                   **      **                     **      **                   
                  ****    ****                   ****    ****                  
                 **  **  **  **                 **  **  **  **                 
                ****************               ****************                
               **              **             **              **               
              ****            ****           ****            ****              
             **  **          **  **         **  **          **  **             
            ********        ********       ********        ********            
           **      **      **      **     **      **      **      **           
          ****    ****    ****    ****   ****    ****    ****    ****          
         **  **  **  **  **  **  **  ** **  **  **  **  **  **  **  **         
        ***************************************************************        
       **                                                             **       
      ****                                                           ****      
     **  **                                                         **  **     
    ********                                                       ********    
   **      **                                                     **      **   
  ****    ****                                                   ****    ****  
 **  **  **  **                                                 **  **  **  ** 
****************                                               ****************
*              **                                             **              *
**            ****                                           ****            **
 **          **  **                                         **  **          ** 
****        ********                                       ********        ****
   **      **      **                                     **      **      **   
  ****    ****    ****                                   ****    ****    ****  
 **  **  **  **  **  **                                 **  **  **  **  **  ** 
************************                               ************************
                       **                             **                       
                      ****                           ****                      
                     **  **                         **  **                     
                    ********                       ********                    
                   **      **                     **      **                   
                  ****    ****                   ****    ****                  
                 **  **  **  **                 **  **  **  **                 
                ****************               ****************                
*              **              **             **              **              *
**            ****            ****           ****            ****            **
 **          **  **          **  **         **  **          **  **          ** 
****        ********        ********       ********        ********        ****
   **      **      **      **      **     **      **      **      **      **   
  ****    ****    ****    ****    ****   ****    ****    ****    ****    ****  
 **  **  **  **  **  **  **  **  **  ** **  **  **  **  **  **  **  **  **  ** 
*******************************************************************************
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
                                                                               
*                                                                             *
**                                                                           **
 **                                                                         ** 
****                                                                       ****
   **                                                                     **   
  ****                                                                   ****  
 **  **                                                                 **  ** 
********                                                               ********
       **                                                             **       
      ****                                                           ****      
     **  **                                                         **  **     
    ********                                                       ********    
   end

------------------------------------------------------------------------*/

/* ------------------------- run #3 -----------------------------------

Enter Rule (0 - 255): 131
   start
                                       *                                       
***************************************  **************************************
**************************************  * *************************************
*************************************  *   ************************************
************************************  *  ** ***********************************
***********************************  *  *    **********************************
**********************************  *  *  *** *********************************
*********************************  *  *  * *   ********************************
********************************  *  *  *    ** *******************************
*******************************  *  *  *  ***    ******************************
******************************  *  *  *  * *  *** *****************************
*****************************  *  *  *  *    * *   ****************************
****************************  *  *  *  *  ***    ** ***************************
***************************  *  *  *  *  * *  ***    **************************
**************************  *  *  *  *  *    * *  *** *************************
*************************  *  *  *  *  *  ***    * *   ************************
************************  *  *  *  *  *  * *  ***    ** ***********************
***********************  *  *  *  *  *  *    * *  ***    **********************
**********************  *  *  *  *  *  *  ***    * *  *** *********************
*********************  *  *  *  *  *  *  * *  ***    * *   ********************
********************  *  *  *  *  *  *  *    * *  ***    ** *******************
*******************  *  *  *  *  *  *  *  ***    * *  ***    ******************
******************  *  *  *  *  *  *  *  * *  ***    * *  *** *****************
*****************  *  *  *  *  *  *  *  *    * *  ***    * *   ****************
****************  *  *  *  *  *  *  *  *  ***    * *  ***    ** ***************
***************  *  *  *  *  *  *  *  *  * *  ***    * *  ***    **************
**************  *  *  *  *  *  *  *  *  *    * *  ***    * *  *** *************
*************  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *   ************
************  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    ** ***********
***********  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    **********
**********  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  *** *********
*********  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *   ********
********  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    ** *******
*******  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    ******
******  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  *** *****
*****  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *   ****
****  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    ** ***
***  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    **
**  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  *** *
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *   
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    **
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
  *  *  *  *  *  *  *  *  *  *  *  *  *  * *  ***    * *  ***    * *  ***    * 
 *  *  *  *  *  *  *  *  *  *  *  *  *  *    * *  ***    * *  ***    * *  ***  
*  *  *  *  *  *  *  *  *  *  *  *  *  *  ***    * *  ***    * *  ***    * *  *
   end

-----------------------------------------------------------------------------*/

/*--------------------------- run #4 ---------------------------------------

Enter Rule (0 - 255): 254
   start
                                       *                                       
                                      ***                                      
                                     *****                                     
                                    *******                                    
                                   *********                                   
                                  ***********                                  
                                 *************                                 
                                ***************                                
                               *****************                               
                              *******************                              
                             *********************                             
                            ***********************                            
                           *************************                           
                          ***************************                          
                         *****************************                         
                        *******************************                        
                       *********************************                       
                      ***********************************                      
                     *************************************                     
                    ***************************************                    
                   *****************************************                   
                  *******************************************                  
                 *********************************************                 
                ***********************************************                
               *************************************************               
              ***************************************************              
             *****************************************************             
            *******************************************************            
           *********************************************************           
          ***********************************************************          
         *************************************************************         
        ***************************************************************        
       *****************************************************************       
      *******************************************************************      
     *********************************************************************     
    ***********************************************************************    
   *************************************************************************   
  ***************************************************************************  
 ***************************************************************************** 
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
   end

---------------------------------------------------------------------------*/